<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JetEco - Delicious. Profitable. Eco-friendly.</title>
    <link rel="stylesheet" href="/css/home-style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<header class="main-header">
    <div class="container header-content">
        <div class="logo">
            <img src="https://i.postimg.cc/CM8zvVFg/jeteco-logo.png" alt="JetEco Logo" />
        </div>
        <nav class="main-nav">
            <ul>
                <li><a href="/about" class="active">About Us</a></li>
                <li><a href="/partners">Partners</a></li>
                <li><a href="/how-it-works">How It Works</a></li>
            </ul>
        </nav>
        <div class="header-actions">
            <form class="search-bar" action="/search" method="get">
                <input type="text" id="searchInput" placeholder="Search by product name..." />
                <button type="submit"><i class="fas fa-search"></i></button>
            </form>
            <a href="#" class="icon-button" id="cart-icon" onclick="window.location.href='/basket'">
                <i class="fas fa-shopping-cart"></i>
            </a>

            <div th:if="${#strings.isEmpty(name)}">
                <button class="btn login-btn" onclick="window.location.href='/login'">Login</button>
                <button class="btn register-btn" onclick="window.location.href='/register'">Register</button>
            </div>

            <div th:if="${!#strings.isEmpty(name)}" class="user-profile" style="display: flex; align-items: center; gap: 8px;">
                <img
                        id="profile-avatar"
                        th:src="${picture}"
                        alt="Profile picture"
                        style="width:32px; height:32px; border-radius:50%; cursor:pointer;"
                        title="Go to profile"
                />
                <span class="profile-name" th:text="${name}"></span>
                <form th:action="@{/logout}" method="post" style="margin-left: 12px;">
                    <button type="submit" class="btn button-primary">Logout</button>
                </form>
                <div>
                    <button class="partner-button" onclick="window.location.href='/partner-page'">P</button>
                </div>
            </div>
        </div>
    </div>
</header>
<main>
    <section class="hero-section">
        <div class="container hero-content">
            <div class="hero-text">
                <h4>Delicious. Profitable. Eco-friendly.</h4>
                <p>Discover new flavors and healthy habits with JetEco. We offer fresh, high-quality products delivered straight to your doorstep.</p>
                <a href="#how-to-order-section" class="button button-primary">Order Now</a>
            </div>
            <div class="hero-images">
                <img src="https://images.unsplash.com/photo-1543353071-c953d88f7033?q=80&w=3125&auto=format&fit=crop" alt="Food image 1" class="food-img food-img-large">
                <img src="https://images.unsplash.com/photo-1632142334511-8f24c3d3ae79?q=80&w=3088&auto=format&fit=crop" alt="Food image 2" class="food-img food-img-small-top">
                <img src="https://plus.unsplash.com/premium_photo-1661636006793-41424adb9b8f?q=80&w=2940&auto=format&fit=crop" alt="Food image 3" class="food-img food-img-small-bottom">
            </div>
        </div>
    </section>

    <section class="partners-section">
        <div class="container">
            <h2>How to Order</h2>
            <p class="section-description">Product quality is our priority. We work only with the best to ensure freshness until the moment it reaches your hands.</p>
            <div class="partner-cards">
                <div class="partner-card">
                    <img src="https://i.postimg.cc/cCpcqqHz/2025-05-25-20-20-06.png" alt="Green button">
                    <h3>Click Add to Cart</h3>
                </div>
                <div class="partner-card">
                    <img src="https://i.postimg.cc/R0T9N4xc/2025-05-25-20-32-29.png" alt="Cart icon">
                    <h3>Click on the Cart</h3>
                </div>
                <div class="partner-card">
                    <img src="https://i.postimg.cc/cCpcqqHz/2025-05-25-20-20-06.png" alt="Confirm">
                    <h3>Click Confirm Order and pick it up at the branch</h3>
                </div>
            </div>
        </div>
    </section>

    <section id="how-to-order-section" class="how-to-order-section">
        <div class="container">
            <h2>Popular Orders</h2>
            <p class="section-description">All products in the app undergo quality control and are offered within a few hours of preparation.</p>
            <div class="food-items-grid">
                <div class="food-item-card">
                    <img src="https://images.unsplash.com/photo-1569419904069-081571452242?q=80&w=3087&auto=format&fit=crop" alt="Food Box 1">
                    <h3>Food Box from Bublik</h3>
                    <p>400 grams</p>
                    <div class="price-like">
                        <span>190 som</span>
                        <button class="add-to-cart-btn">Add to Cart</button>
                    </div>
                </div>
                <div class="food-item-card">
                    <img src="https://images.unsplash.com/photo-1644203542040-2df37e3580ef?q=80&w=2940&auto=format&fit=crop" alt="Food Box 2">
                    <h3>Food Box from Belagio</h3>
                    <p>800 grams</p>
                    <div class="price-like">
                        <span>200 som</span>
                        <button class="add-to-cart-btn">Add to Cart</button>
                    </div>
                </div>
                <div class="food-item-card">
                    <img src="https://images.unsplash.com/photo-1616645258469-ec681c17f3ee?q=80&w=2940&auto=format&fit=crop" alt="Sandwich">
                    <h3>Food Box from Ula Food</h3>
                    <p>500 grams</p>
                    <div class="price-like">
                        <span>100 som</span>
                        <button class="add-to-cart-btn">Add to Cart</button>
                    </div>
                </div>
                <div class="food-items-grid" id="popularProducts"></div>

            </div>
            <div class="all-products-button-wrapper">
                <a href="#how-to-order-section" class="btn button-primary">All Products</a>
            </div>
        </div>
    </section>
    <section class="info-block">
        <div class="container">
            <p>All products in the application undergo quality control and are offered several hours before their expiration date. Shop chefs pack food in clean containers, observing sanitary standards, ensuring the taste and freshness of the food is as high as ever, simply with a limited sale period. Together we help reduce food waste and care for the future.</p>
        </div>
    </section>
</main>

<footer class="main-footer">
    <div class="container footer-content">
        <div class="footer-section footer-company">
            <h3>JetEco</h3>
            <p>Delicious. Profitable. Eco-friendly.</p>
            <div class="social-icons">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.instagram.com/soullovesoil/"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
            </div>
        </div>
        <div class="footer-section footer-links">
            <h3>Company</h3>
            <ul>
                <li><a href="#">About Us</a></li>
                <li><a href="/partners">Partners</a></li>
                <li><a href="/how-it-works">How It Works</a></li>
            </ul>
        </div>
        <div class="footer-section footer-contact">
            <h3>Our Contacts</h3>
            <p><a class="example" href="mailto:jeteco@example.com">jeteco@example.com</a> </p>
        </div>
    </div>
    <div class="footer-bottom">
        <div class="container">
            <p>&copy; 2025 JetEco. All rights Reserved.</p>
        </div>
    </div>
</footer>

<script th:inline="javascript">
        document.querySelectorAll(".add-to-cart-btn").forEach(button => {
        button.addEventListener("click", (e) => {
            const card = e.target.closest(".food-item-card");
            const img = card.querySelector("img");
            const cart = document.getElementById("cart-icon");

            if (!img || !cart) return;

            const imgRect = img.getBoundingClientRect();
            const cartRect = cart.getBoundingClientRect();

            const imgClone = img.cloneNode(true);
            imgClone.classList.add("flying-img");

            imgClone.style.top = imgRect.top + "px";
            imgClone.style.left = imgRect.left + "px";
            imgClone.style.width = imgRect.width + "px";

            document.body.appendChild(imgClone);

            requestAnimationFrame(() => {
                imgClone.style.top = cartRect.top + "px";
                imgClone.style.left = cartRect.left + "px";
                imgClone.style.width = "30px";
                imgClone.style.opacity = "0.5";
            });

            imgClone.addEventListener("transitionend", () => {
                imgClone.remove();
                cart.classList.add("bounce");
                setTimeout(() => cart.classList.remove("bounce"), 300);
            });
        });
    });

// Script remains largely the same, only console logs translated
const role = /*[[${role}]]*/ 'ROLE_ANONYMOUS';
console.log("Role check: ", role);
</script>
<script>
    const container = document.getElementById("popularProducts");
    const products = JSON.parse(localStorage.getItem("partnerProducts")) || [];

    products.forEach((product, index) => {
        const card = document.createElement("div");
        card.className = "food-item-card";

        card.innerHTML = `
      <img src="${product.image}">
      <h3>${product.name}</h3>
      <p>${product.weight || "-"} grams</p>
      <div class="price-like">
        <span>${product.price} som</span>
        <button class="add-to-cart-btn" data-index="${index}">
          Add to Cart
        </button>
      </div>
    `;

        container.appendChild(card);
    });

    // навешиваем обработчики
    document.querySelectorAll(".add-to-cart-btn").forEach(btn => {
        btn.addEventListener("click", (e) => {
            const index = e.target.dataset.index;
            const product = products[index];

            addToCart(product);
            animateToCart(e.target);
        });
    });

    function animateToCart(button) {
        const card = button.closest(".food-item-card");
        const img = card.querySelector("img");
        const cart = document.getElementById("cart-icon");
        if (!img || !cart) return;

        const imgRect = img.getBoundingClientRect();
        const cartRect = cart.getBoundingClientRect();
        const imgClone = img.cloneNode(true);

        imgClone.classList.add("flying-img");
        imgClone.style.top = imgRect.top + "px";
        imgClone.style.left = imgRect.left + "px";
        imgClone.style.width = imgRect.width + "px";

        document.body.appendChild(imgClone);

        requestAnimationFrame(() => {
            imgClone.style.top = cartRect.top + "px";
            imgClone.style.left = cartRect.left + "px";
            imgClone.style.width = "30px";
            imgClone.style.opacity = "0.5";
        });

        imgClone.addEventListener("transitionend", () => {
            imgClone.remove();
            cart.classList.add("bounce");
            setTimeout(() => cart.classList.remove("bounce"), 300);
        });
    }
</script>

<script>
    function addToCart(product) {
        const cart = JSON.parse(localStorage.getItem("cartItems")) || [];

        // ищем, есть ли уже такой товар
        const existing = cart.find(item =>
            item.name === product.name &&
            item.partner === product.partner
        );

        if (existing) {
            existing.quantity = (existing.quantity || 1) + 1;
        } else {
            cart.push({
                ...product,
                quantity: 1
            });
        }

        localStorage.setItem("cartItems", JSON.stringify(cart));
        console.log("Cart:", cart);
    }
</script>

</body>
</html>